
<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Aspect Ratio Calculator</title>
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Google Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <!-- Shared Styles -->
    <link rel="stylesheet" href="/trading/assets/css/styles.css">
    <!-- Global App Config -->
    <script src="/trading/assets/js/config.js"></script>
    <style>
        .preset-card {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        
        .preset-card:hover {
            border-color: var(--bs-primary);
            transform: translateY(-2px);
        }
        
        .preset-card.selected {
            border-color: var(--bs-primary);
            background-color: var(--bs-primary-bg-subtle);
        }
        
        .ratio-display {
            font-family: var(--bs-font-monospace);
            font-size: 1.1rem;
        }
        
        .dimension-visual {
            border: 2px solid var(--bs-border-color);
            border-radius: 0.375rem;
            padding: 1rem;
            min-height: 120px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--bs-secondary-bg);
            position: relative;
        }
        
        .dimension-box {
            border: 2px dashed var(--bs-primary);
            background-color: var(--bs-primary-bg-subtle);
            color: var(--bs-primary);
            padding: 0.5rem;
            border-radius: 0.25rem;
            font-weight: bold;
            text-align: center;
        }
        
        .copy-btn {
            transition: all 0.3s ease;
        }
        
        .section-divider {
            border-top: 2px solid var(--bs-border-color);
            margin: 2rem 0;
        }
    </style>
</head>
<body class="aspect-ratio-calculator-page d-flex flex-column vh-100">
    <div id="header-placeholder"></div>
    <div id="navbar-placeholder"></div>

    <main class="flex-grow-1">
        <div class="container py-4">
            <h1 class="mb-2 text-center">Aspect Ratio Calculator</h1>
            <p class="text-center text-muted mb-4">Calculate aspect ratios, resize dimensions, and work with common screen resolutions.</p>

            <!-- Preset Selection -->
            <div class="row g-4 mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0">
                                Common Presets
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="preset-select" class="form-label">Select a Preset</label>
                                <select id="preset-select" class="form-select">
                                    <option value="">Choose a preset...</option>
                                    <optgroup label="Screen Resolutions">
                                        <option value="800x600">SVGA - 800×600 (4:3)</option>
                                        <option value="1024x600">WSVGA - 1024×600 (17:10)</option>
                                        <option value="1024x768">XGA - 1024×768 (4:3)</option>
                                        <option value="1152x864">XGA+ - 1152×864 (4:3)</option>
                                        <option value="1280x720">HD 720p - 1280×720 (16:9)</option>
                                        <option value="1280x800">WXGA - 1280×800 (16:10)</option>
                                        <option value="1280x960">UVGA - 1280×960 (4:3)</option>
                                        <option value="1280x1024">SXGA - 1280×1024 (5:4)</option>
                                        <option value="1440x900">WXGA+ - 1440×900 (16:10)</option>
                                        <option value="1920x1080">Full HD - 1920×1080 (16:9)</option>
                                        <option value="1920x1200">WUXGA - 1920×1200 (16:10)</option>
                                        <option value="2560x1440">QHD - 2560×1440 (16:9)</option>
                                        <option value="3840x2160">4K UHD - 3840×2160 (16:9)</option>
                                    </optgroup>
                                    <optgroup label="Social Media">
                                        <option value="1080x1080">Instagram Post - 1080×1080 (1:1)</option>
                                        <option value="1080x1350">Instagram Portrait - 1080×1350 (4:5)</option>
                                        <option value="1080x1920">Instagram Story - 1080×1920 (9:16)</option>
                                        <option value="1200x630">Facebook Post - 1200×630 (1.91:1)</option>
                                        <option value="1024x512">Twitter Header - 1024×512 (2:1)</option>
                                    </optgroup>
                                    <optgroup label="Print & Design">
                                        <option value="3000x3000">Album Cover - 3000×3000 (1:1)</option>
                                        <option value="2480x3508">A4 300dpi - 2480×3508 (√2:1)</option>
                                        <option value="1240x1754">A4 150dpi - 1240×1754 (√2:1)</option>
                                    </optgroup>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Section -->
            <div class="row g-4 mb-4">
                <div class="col-lg-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">
                                Dimensions
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="row g-3">
                                <div class="col-6">
                                    <label for="width-input" class="form-label">Width</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="width-input" placeholder="1920" min="1">
                                        <span class="input-group-text">px</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <label for="height-input" class="form-label">Height</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="height-input" placeholder="1080" min="1">
                                        <span class="input-group-text">px</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-center mt-4">
                                <button type="button" id="calculate-btn" class="btn btn-primary">Calculate</button>
                                <button type="button" id="swap-btn" class="btn btn-outline-secondary ms-2">Swap</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                Aspect Ratio
                            </h5>
                            <button id="copy-ratio-btn" class="btn btn-sm btn-outline-secondary copy-btn" style="display: none;">Copy</button>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="ratio-decimal" class="form-label">Decimal Ratio</label>
                                <input type="text" class="form-control ratio-display" id="ratio-decimal" readonly placeholder="1.78:1">
                            </div>
                            <div class="mb-3">
                                <label for="ratio-simplified" class="form-label">Simplified Ratio</label>
                                <input type="text" class="form-control ratio-display" id="ratio-simplified" readonly placeholder="16:9">
                            </div>
                            <div class="dimension-visual" id="visual-preview">
                                <div class="text-muted">Visual preview will appear here</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resize Calculator -->
            <div class="section-divider"></div>
            
            <div class="row g-4">
                <div class="col-lg-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">
                                Resize Calculator
                            </h5>
                        </div>
                        <div class="card-body">
                            <p class="text-muted mb-3">Enter a target dimension to calculate the corresponding size while maintaining aspect ratio.</p>
                            
                            <div class="row g-3 mb-3">
                                <div class="col-6">
                                    <label for="target-width" class="form-label">Target Width</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="target-width" placeholder="800" min="1">
                                        <span class="input-group-text">px</span>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <label for="target-height" class="form-label">Target Height</label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="target-height" placeholder="600" min="1">
                                        <span class="input-group-text">px</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-center">
                                <button type="button" id="resize-calculate-btn" class="btn btn-primary">Calculate</button>
                                <button type="button" id="resize-swap-btn" class="btn btn-outline-secondary ms-2">Swap</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="card h-100">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                Calculated Dimensions
                            </h5>
                            <button id="copy-dimensions-btn" class="btn btn-sm btn-outline-secondary copy-btn" style="display: none;">Copy</button>
                        </div>
                        <div class="card-body">
                            <div class="mb-3">
                                <label for="calculated-width" class="form-label">Calculated Width</label>
                                <input type="text" class="form-control ratio-display" id="calculated-width" readonly placeholder="800 px">
                            </div>
                            <div class="mb-3">
                                <label for="calculated-height" class="form-label">Calculated Height</label>
                                <input type="text" class="form-control ratio-display" id="calculated-height" readonly placeholder="450 px">
                            </div>
                            <div id="resize-info" class="alert alert-info" style="display: none;">
                                <small class="text-muted">Resize information will appear here</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-center mt-4">
                <button type="button" id="reset-btn" class="btn btn-outline-secondary">Reset All</button>
            </div>

            <div class="text-center mt-4">
                <small class="text-muted">
                    Inspired by 
                    <a href="https://www.digitalrebellion.com/webapps/aspectcalc" target="_blank" class="link-secondary">Digital Rebellion's Aspect Calculator</a>
                </small>
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <!-- jQuery 3.7.1 -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <!-- Bootstrap 5.3 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Shared Header Script -->
    <script src="/trading/assets/js/header.js"></script>

    <script>
        $(document).ready(function() {
            // Debug logging function that checks global debug mode
            function debugLog(...args) {
                const debugSwitch = $('#enable-debug-mode-switch');
                if (debugSwitch.length && debugSwitch.is(':checked')) {
                    console.log(...args);
                }
            }

            // --- Load Shared Components ---
            $("#header-placeholder").load("/trading/assets/includes/_header.html", () => initializeHeader && initializeHeader());
            $("#navbar-placeholder").load("/trading/assets/includes/_navbar.html");
            $("#footer-placeholder").load("/trading/assets/includes/_footer.html");

            // --- Constants and Selectors ---
            const STORAGE_KEY = 'aspectRatioCalculatorState';
            const $presetSelect = $('#preset-select');
            const $widthInput = $('#width-input');
            const $heightInput = $('#height-input');
            const $ratioDecimal = $('#ratio-decimal');
            const $ratioSimplified = $('#ratio-simplified');
            const $visualPreview = $('#visual-preview');
            const $targetWidth = $('#target-width');
            const $targetHeight = $('#target-height');
            const $calculatedWidth = $('#calculated-width');
            const $calculatedHeight = $('#calculated-height');
            const $resizeInfo = $('#resize-info');

            let currentRatio = null;

            // --- Core Functions ---
            function gcd(a, b) {
                return b === 0 ? a : gcd(b, a % b);
            }

            function calculateAspectRatio() {
                const width = parseInt($widthInput.val());
                const height = parseInt($heightInput.val());

                if (!width || !height || width <= 0 || height <= 0) {
                    clearRatioDisplay();
                    return;
                }

                debugLog('Calculating aspect ratio for:', width, 'x', height);

                // Calculate decimal ratio
                const decimal = (width / height).toFixed(3);
                $ratioDecimal.val(`${decimal}:1`);

                // Calculate simplified ratio using GCD
                const divisor = gcd(width, height);
                const simplifiedWidth = width / divisor;
                const simplifiedHeight = height / divisor;
                $ratioSimplified.val(`${simplifiedWidth}:${simplifiedHeight}`);

                // Store current ratio for resize calculations
                currentRatio = { width: simplifiedWidth, height: simplifiedHeight };

                // Update visual preview
                updateVisualPreview(simplifiedWidth, simplifiedHeight);

                // Show copy button
                $('#copy-ratio-btn').show();

                saveState();
            }

            function updateVisualPreview(ratioWidth, ratioHeight) {
                const maxSize = 80; // Max dimension for preview
                let displayWidth, displayHeight;

                if (ratioWidth >= ratioHeight) {
                    displayWidth = maxSize;
                    displayHeight = (maxSize * ratioHeight) / ratioWidth;
                } else {
                    displayHeight = maxSize;
                    displayWidth = (maxSize * ratioWidth) / ratioHeight;
                }

                $visualPreview.html(`
                    <div class="dimension-box" style="width: ${displayWidth}px; height: ${displayHeight}px;">
                        ${ratioWidth}:${ratioHeight}
                    </div>
                `);
            }

            function clearRatioDisplay() {
                $ratioDecimal.val('');
                $ratioSimplified.val('');
                $visualPreview.html('<div class="text-muted">Visual preview will appear here</div>');
                $('#copy-ratio-btn').hide();
                currentRatio = null;
            }

            function calculateResize() {
                if (!currentRatio) {
                    alert('Please calculate an aspect ratio first.');
                    return;
                }

                const targetW = parseInt($targetWidth.val());
                const targetH = parseInt($targetHeight.val());

                if (!targetW && !targetH) {
                    alert('Please enter either a target width or height.');
                    return;
                }

                let newWidth, newHeight, info;

                if (targetW && !targetH) {
                    // Calculate height based on width
                    newWidth = targetW;
                    newHeight = Math.round((targetW * currentRatio.height) / currentRatio.width);
                    info = `Height calculated based on width of ${targetW}px`;
                } else if (targetH && !targetW) {
                    // Calculate width based on height
                    newHeight = targetH;
                    newWidth = Math.round((targetH * currentRatio.width) / currentRatio.height);
                    info = `Width calculated based on height of ${targetH}px`;
                } else {
                    // Both provided - show which one would be adjusted
                    const calculatedH = Math.round((targetW * currentRatio.height) / currentRatio.width);
                    const calculatedW = Math.round((targetH * currentRatio.width) / currentRatio.height);
                    
                    if (Math.abs(calculatedH - targetH) <= Math.abs(calculatedW - targetW)) {
                        newWidth = targetW;
                        newHeight = calculatedH;
                        info = `Height adjusted to ${calculatedH}px to maintain aspect ratio`;
                    } else {
                        newWidth = calculatedW;
                        newHeight = targetH;
                        info = `Width adjusted to ${calculatedW}px to maintain aspect ratio`;
                    }
                }

                $calculatedWidth.val(`${newWidth} px`);
                $calculatedHeight.val(`${newHeight} px`);
                $resizeInfo.html(`<small>${info}</small>`).show();
                $('#copy-dimensions-btn').show();

                debugLog('Resize calculation:', { newWidth, newHeight, info });
                saveState();
            }

            // --- Copy Functions ---
            function copyToClipboard(text, $button) {
                navigator.clipboard.writeText(text).then(() => {
                    const originalText = $button.text();
                    $button.text('Copied!');
                    $button.addClass('btn-success').removeClass('btn-outline-secondary');
                    setTimeout(() => {
                        $button.text(originalText).removeClass('btn-success').addClass('btn-outline-secondary');
                    }, 1500);
                }).catch(err => {
                    console.error('Failed to copy:', err);
                    alert('Failed to copy to clipboard.');
                });
            }

            // --- State Management ---
            function saveState() {
                const state = {
                    preset: $presetSelect.val(),
                    width: $widthInput.val(),
                    height: $heightInput.val(),
                    targetWidth: $targetWidth.val(),
                    targetHeight: $targetHeight.val(),
                    currentRatio: currentRatio
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            }

            function loadState() {
                const savedState = localStorage.getItem(STORAGE_KEY);
                if (savedState) {
                    const state = JSON.parse(savedState);
                    
                    if (state.preset) $presetSelect.val(state.preset);
                    if (state.width) $widthInput.val(state.width);
                    if (state.height) $heightInput.val(state.height);
                    if (state.targetWidth) $targetWidth.val(state.targetWidth);
                    if (state.targetHeight) $targetHeight.val(state.targetHeight);
                    if (state.currentRatio) currentRatio = state.currentRatio;
                    
                    // Recalculate if we have dimensions
                    if (state.width && state.height) {
                        calculateAspectRatio();
                    }
                }
            }

            // --- Event Listeners ---
            $presetSelect.on('change', function() {
                const preset = $(this).val();
                if (preset) {
                    const [width, height] = preset.split('x');
                    $widthInput.val(width);
                    $heightInput.val(height);
                    calculateAspectRatio();
                }
                saveState();
            });

            $widthInput.add($heightInput).on('input', function() {
                calculateAspectRatio();
            });

            $('#calculate-btn').on('click', calculateAspectRatio);

            $('#swap-btn').on('click', function() {
                const width = $widthInput.val();
                const height = $heightInput.val();
                $widthInput.val(height);
                $heightInput.val(width);
                calculateAspectRatio();
            });

            $targetWidth.add($targetHeight).on('input', function() {
                saveState();
            });

            $('#resize-calculate-btn').on('click', calculateResize);

            $('#resize-swap-btn').on('click', function() {
                const width = $targetWidth.val();
                const height = $targetHeight.val();
                $targetWidth.val(height);
                $targetHeight.val(width);
                calculateResize();
            });

            $('#copy-ratio-btn').on('click', function() {
                const ratio = $ratioSimplified.val();
                if (ratio) {
                    copyToClipboard(ratio, $('#copy-ratio-btn'));
                }
            });

            $('#copy-dimensions-btn').on('click', function() {
                const width = $calculatedWidth.val().replace(' px', '');
                const height = $calculatedHeight.val().replace(' px', '');
                const text = `${width}x${height}`;
                copyToClipboard(text, $('#copy-dimensions-btn'));
            });

            $('#reset-btn').on('click', function() {
                $presetSelect.val('');
                $widthInput.val('');
                $heightInput.val('');
                $targetWidth.val('');
                $targetHeight.val('');
                $calculatedWidth.val('');
                $calculatedHeight.val('');
                clearRatioDisplay();
                $resizeInfo.hide();
                $('#copy-dimensions-btn').hide();
                localStorage.removeItem(STORAGE_KEY);
            });

            // --- Initialize ---
            loadState();
            
            // Set default example if no state
            if (!$widthInput.val() && !$heightInput.val()) {
                $widthInput.val('1920');
                $heightInput.val('1080');
                calculateAspectRatio();
            }
        });
    </script>
</body>
</html>