<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Character Case Converter</title>
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Google Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
    <!-- Shared Styles -->
    <link rel="stylesheet" href="/trading/assets/css/styles.css">
    <!-- Global App Config -->
    <script src="/trading/assets/js/config.js"></script>
    <style>
        #text-input {
            min-height: 250px;
            resize: vertical;
        }
        .stats-bar {
            font-family: var(--bs-font-monospace);
        }
    </style>
</head>
<body class="character-converter-page d-flex flex-column vh-100">
    <div id="header-placeholder"></div>
    <div id="navbar-placeholder"></div>

    <main class="flex-grow-1">
        <div class="container py-4">
            <h1 class="mb-2 text-center">Character Case Converter</h1>
            <p class="text-center text-muted mb-4">Convert text between different letter cases.</p>

            <div class="card">
                <div class="card-header">
                    <div class="d-flex flex-wrap gap-2" id="case-buttons">
                        <button class="btn btn-sm btn-outline-secondary" data-case="sentence">Sentence case</button>
                        <button class="btn btn-sm btn-outline-secondary" data-case="lower">lower case</button>
                        <button class="btn btn-sm btn-outline-secondary" data-case="upper">UPPER CASE</button>
                        <button class="btn btn-sm btn-outline-secondary" data-case="capitalized">Capitalized Case</button>
                        <button class="btn btn-sm btn-outline-secondary" data-case="title">Title Case</button>
                        <button class="btn btn-sm btn-outline-secondary" data-case="alternating">aLtErNaTiNg cAsE</button>
                        <button class="btn btn-sm btn-outline-secondary" data-case="inverse">AlTeRnAtInG CaSe</button>
                    </div>
                </div>
                <div class="card-body">
                    <textarea id="text-input" class="form-control" placeholder="Enter or paste your text here..."></textarea>
                </div>
                <div class="card-footer d-flex flex-column flex-sm-row justify-content-between align-items-center gap-2">
                    <div id="stats-bar" class="text-muted small stats-bar">
                        <span>Character Count: 0</span> |
                        <span>Word Count: 0</span> |
                        <span>Sentence Count: 0</span> |
                        <span>Line Count: 0</span>
                    </div>
                    <div class="d-flex gap-2">
                        <button id="copy-btn" class="btn btn-outline-secondary">
                            <span class="material-symbols-outlined icon-inline-sm">content_copy</span>
                            Copy
                        </button>
                        <button id="download-btn" class="btn btn-outline-secondary">
                            <span class="material-symbols-outlined icon-inline-sm">download</span>
                            Download
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <!-- jQuery 3.7.1 -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <!-- Bootstrap 5.3 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <!-- Shared Header Script -->
    <script src="/trading/assets/js/header.js"></script>

    <script>
        $(document).ready(function() {
            // --- Load Shared Components ---
            $("#header-placeholder").load("/trading/assets/includes/_header.html", () => initializeHeader && initializeHeader());
            $("#navbar-placeholder").load("/trading/assets/includes/_navbar.html");
            $("#footer-placeholder").load("/trading/assets/includes/_footer.html");

            // --- Constants and Selectors ---
            const STORAGE_KEY = 'characterConverterState';
            const $textInput = $('#text-input');
            const $caseButtons = $('#case-buttons');
            const $copyBtn = $('#copy-btn');
            const $downloadBtn = $('#download-btn');
            const $statsBar = $('#stats-bar');

            let lastCase = 'original';

            // --- State Management ---
            function saveState() {
                const state = {
                    text: $textInput.val(),
                    lastCase: lastCase
                };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
            }

            function loadState() {
                const savedState = localStorage.getItem(STORAGE_KEY);
                if (savedState) {
                    const state = JSON.parse(savedState);
                    $textInput.val(state.text || '');
                    lastCase = state.lastCase || 'original';
                    updateStats();
                }
            }

            // --- Core Logic ---
            function updateStats() {
                const text = $textInput.val();
                const charCount = text.length;
                const wordCount = text.trim().split(/\s+/).filter(Boolean).length;
                const sentenceCount = (text.match(/[.!?]+(\s+|$)/g) || []).length;
                const lineCount = (text.match(/\n/g) || []).length + (text.length > 0 ? 1 : 0);

                $statsBar.html(
                    `<span>Character Count: ${charCount.toLocaleString()}</span> | ` +
                    `<span>Word Count: ${wordCount.toLocaleString()}</span> | ` +
                    `<span>Sentence Count: ${sentenceCount.toLocaleString()}</span> | ` +
                    `<span>Line Count: ${lineCount.toLocaleString()}</span>`
                );
            }

            function convertCase(caseType) {
                let text = $textInput.val();
                switch (caseType) {
                    case 'sentence':
                        text = text.toLowerCase().replace(/(^\s*\w|[.!?]\s+\w)/g, c => c.toUpperCase());
                        break;
                    case 'lower':
                        text = text.toLowerCase();
                        break;
                    case 'upper':
                        text = text.toUpperCase();
                        break;
                    case 'capitalized':
                        text = text.toLowerCase().replace(/\b\w/g, c => c.toUpperCase());
                        break;
                    case 'title':
                        const smallWords = /^(a|an|and|as|at|but|by|en|for|if|in|nor|of|on|or|per|the|to|vs?\.?|via)$/i;
                        text = text.toLowerCase().replace(/[A-Za-z0-9\u00C0-\u00FF]+[^\s-]*/g, (word, index) => {
                            if (index > 0 && index + word.length !== text.length && smallWords.test(word)) {
                                return word;
                            }
                            return word.charAt(0).toUpperCase() + word.slice(1);
                        });
                        break;
                    case 'alternating': // aLtErNaTiNg
                        text = text.split('').map((c, i) => i % 2 === 0 ? c.toLowerCase() : c.toUpperCase()).join('');
                        break;
                    case 'inverse': // AlTeRnAtInG
                        text = text.split('').map((c, i) => i % 2 === 0 ? c.toUpperCase() : c.toLowerCase()).join('');
                        break;
                }
                $textInput.val(text);
                lastCase = caseType;
                updateActiveButton(caseType);
                updateStats();
                saveState();
            }

            function updateActiveButton(caseType) {
                $caseButtons.find('button').removeClass('active');
                $caseButtons.find(`button[data-case="${caseType}"]`).addClass('active');
            }

            function copyToClipboard() {
                const textToCopy = $textInput.val();
                if (!textToCopy) return;

                navigator.clipboard.writeText(textToCopy).then(() => {
                    const originalIcon = $copyBtn.find('.material-symbols-outlined').text();
                    const originalText = $copyBtn.contents().filter(function() { return this.nodeType === 3; }).text();
                    $copyBtn.find('.material-symbols-outlined').text('check');
                    $copyBtn.contents().filter(function() { return this.nodeType === 3; }).replaceWith(' Copied!');
                    $copyBtn.addClass('btn-success').removeClass('btn-outline-secondary');

                    setTimeout(() => {
                        $copyBtn.find('.material-symbols-outlined').text(originalIcon);
                        $copyBtn.contents().filter(function() { return this.nodeType === 3; }).replaceWith(originalText);
                        $copyBtn.removeClass('btn-success').addClass('btn-outline-secondary');
                    }, 1500);
                }).catch(err => {
                    console.error('Failed to copy text: ', err);
                    alert('Failed to copy text.');
                });
            }

            function downloadText() {
                const textToSave = $textInput.val();
                if (!textToSave) return;

                const now = new Date();
                const year = now.getFullYear().toString().slice(-2);
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const dateStr = `${year}${month}${day}`;
                
                const caseName = lastCase.replace(/\s+/g, '-').toLowerCase();
                const filename = `${dateStr}-${caseName}.txt`;

                const blob = new Blob([textToSave], { type: 'text/plain' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            // --- Event Listeners ---
            $textInput.on('input', () => {
                updateStats();
                saveState();
                // When user types, no case is "active"
                lastCase = 'original';
                $caseButtons.find('button').removeClass('active');
            });

            $caseButtons.on('click', 'button', function() {
                const caseType = $(this).data('case');
                convertCase(caseType);
            });

            $copyBtn.on('click', copyToClipboard);
            $downloadBtn.on('click', downloadText);

            // --- Initial Load ---
            loadState();
        });
    </script>
</body>
</html>